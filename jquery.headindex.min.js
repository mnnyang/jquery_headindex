/*!
 * jquery_headindex
 * https://github.com/xxyangyoulin/jquery_headindex
 */
;(function(b,a){var c=(function(){function d(f,e){this.settings=b.extend({},b.fn.headIndex.def,e||{});this.element=f;console.log(this.settings.hasDynamicEffect);this.init()}d.prototype={init:function(){this.articleWrap=b(this.settings.articleWrapSelector);this.headerList=this.settings.excludeSelector?this.articleWrap.find(":header").not(this.settings.excludeSelector):this.articleWrap.find(":header");this.indexBox=b(this.settings.indexBoxSelector);this.scrollBody=b(this.settings.scrollSelector);this.scrollWrap=b(this.settings.scrollWrap);this.manual=false;var e=b(this.settings.indexBoxWrap);if(this.indexBox.length===0||this.headerList.length===0){if(e.length>0){e.hide()}return null}if(e.length>0&&e.is(":hidden")){e.fadeIn()}this.initHeader();this.event()},initHeader:function(){for(var f=0;f<this.headerList.length;f++,this.autoId++){this.headerList[f].id=this.headerList[f].id||"header-id-"+this.autoId;this.headerList[f].topHeight=this.offsetTop(this.headerList[f]);this.headerList[f].h=Number(this.headerList[f].tagName.charAt(1))}this.tempHtml=[];this.buildHtml(this.buildTree());var e="<ul>"+this.tempHtml.join("")+"</ul>";this.indexBox.html(e);if(!this.settings.hasDynamicEffect){b("."+this.settings.subItemBoxClass).show()}},event:function(){const f=this;var e=null;this.indexBox.on("click.headindex",function(h){var i=b(h.target);if(i.hasClass(f.settings.linkClass)){h.preventDefault();var g=i.parent("."+f.settings.itemClass);f.manual=true;if(e){clearTimeout(e);e=null}e=setTimeout(function(){f.manual=false},300);f.current(g);f.scrollTo(h.target.getAttribute("href"))}});b(this.scrollWrap).scroll(function(){if(f.manual){return}f.updateCurrent()});f.updateCurrent()},updateTopHeight:function(){var f=this.headerList.length;var e;if(f===0){return}if(this.headerList[0].topHeight===this.offsetTop(this.headerList[0])&&this.headerList[f-1].topHeight===this.offsetTop(this.headerList[f-1])){return}if((this.headerList[0].topHeight-this.offsetTop(this.headerList[0]))===(this.headerList[f-1].topHeight-this.offsetTop(this.headerList[f-1]))){var g=this.offsetTop(this.headerList[0])-this.headerList[0].topHeight;for(e=0;e<this.headerList.length;e++,this.autoId++){this.headerList[e].topHeight+=g}return}for(e=0;e<this.headerList.length;e++,this.autoId++){this.headerList[e].topHeight=this.offsetTop(this.headerList[e])}},current:function(f){var e,g="current";if(f.length===0||f.hasClass(g)){return}var i=this.indexBox.find("li."+g);if(i.length>0){i.removeClass(g)}f.addClass(g);console.log("hasDynamicEffect"+this.settings.hasDynamicEffect);if(!this.settings.hasDynamicEffect){return}console.log("被执行");this.indexBox.find("ul.open").removeClass("open");e=f.children("."+this.settings.subItemBoxClass);if(e.length>0){e.addClass("open").slideDown()}var h=f.parents("ul."+this.settings.subItemBoxClass);if(h.length>0){h.addClass("open").slideDown()}e=this.indexBox.find("ul."+this.settings.subItemBoxClass).not(".open");if(e.length>0){e.slideUp()}},buildHtml:function(e){if(e===undefined||e.length===0){return}for(var f=0;f<e.length;f++){this.tempHtml.push("<li class='"+this.settings.itemClass+"'><a class='"+this.settings.linkClass+"' href='#"+e[f].item.id+"'>"+e[f].item.innerText+"</a>");if(e[f].children.length!==0){this.tempHtml.push("<ul class='"+this.settings.subItemBoxClass+"'>");this.buildHtml(e[f].children);this.tempHtml.push("</ul>")}this.tempHtml.push("</li>")}},buildTree:function(){var h=null,e,g=[];for(var f=0;f<this.headerList.length;f++){if(h==null){h={item:this.headerList[f],parent:null,children:[]};g.push(h);continue}if(h.item.h<this.headerList[f].h){e={item:this.headerList[f],parent:h,children:[]};h.children.push(e);h=e;continue}if(h.item.h===this.headerList[f].h){e={item:this.headerList[f],parent:h.parent,children:[]};((h.parent&&h.parent.children)||g).push(e);h=e;continue}while(h!=null&&h.item.h>this.headerList[f].h){h=h.parent}if(h==null){h={item:this.headerList[f],parent:null,children:[]};g.push(h);continue}f--}return g},search:function(i,f,g){if(this.headerList.length===0){return null}if(f-i<=1){if(this.headerList[f].topHeight<g){return this.headerList[f]}return this.headerList[i]}if(i<f){var h=parseInt((i+f)/2);var e=this.headerList[h].topHeight;if(g<e){f=h}else{if(g>e){i=h}else{return this.headerList[h]}}return this.search(i,f,g)}},offsetTop:function(f){var e=this.articleWrap[0].getBoundingClientRect().top;var g=f.getBoundingClientRect().top;return parseInt(g-e-this.settings.offset)},scrollTo:function(e){this.scrollBody.stop().animate({scrollTop:this.offsetTop(document.querySelector(e))},"fast")},updateCurrent:function(){var f=this.scrollBody.scrollTop();this.updateTopHeight();var g=this.search(0,this.headerList.length-1,f);if(!g){return}var e=this.indexBox.find('a[href="#'+g.id+'"]').parent("li."+this.settings.itemClass);this.current(e)},clean:function(){this.indexBox.html("");if(this.element){this.indexBox.unbind("click.headindex");this.element.data("headIndex",null)}},ignoreScrollEvent:function(e){if(e){this.manual=true}else{this.manual=false;this.updateCurrent()}}};d.prototype.autoId=1;return d})();b.fn.headIndex=function(d){return this.each(function(){var f=b(this),e=f.data("headIndex");if(!e){console.log("new");e=new c(f,d);f.data("headIndex",e)}if(b.type(d)==="string"){return e[d]()}})};b.fn.headIndex.def={articleWrapSelector:".article-wrap",indexBoxSelector:".index-box",indexBoxWrap:null,scrollSelector:"body,html",scrollWrap:a,hasDynamicEffect:true,excludeSelector:null,offset:0,subItemBoxClass:"index-subItem-box",itemClass:"index-item",linkClass:"index-link"}})(jQuery,window);